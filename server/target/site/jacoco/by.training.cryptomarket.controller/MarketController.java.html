<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MarketController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">server</a> &gt; <a href="index.source.html" class="el_package">by.training.cryptomarket.controller</a> &gt; <span class="el_source">MarketController.java</span></div><h1>MarketController.java</h1><pre class="source lang-java linenums">package by.training.cryptomarket.controller;

import by.training.cryptomarket.command.Command;
import by.training.cryptomarket.command.CommandFactory;


import by.training.cryptomarket.dao.sql.UserDaoImpl;
import by.training.cryptomarket.entity.User;
import by.training.cryptomarket.service.UserServiceInter;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContext;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import javax.annotation.PostConstruct;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.ArrayList;

@Controller
<span class="fc" id="L26">public class MarketController {</span>


    /**
     * The field for storage a logger.
     */
<span class="fc" id="L32">    static final Logger LOGGER = LogManager.getLogger(&quot;by.training.final.ServletLogger&quot;);</span>


    @Autowired
    CommandFactory commandFactory;





    @PostConstruct
    public void init() {

<span class="fc" id="L45">    }</span>




    @RequestMapping(path = &quot;/registration**&quot;)
    public String getRegistration(@RequestParam(value = &quot;command&quot;, required = false)String command,
                                  ModelMap model,HttpServletRequest request,  HttpServletResponse response) {



<span class="fc" id="L56">        model.addAttribute(&quot;registrationmessage&quot;,&quot;&quot;);</span>

<span class="pc bpc" id="L58" title="1 of 2 branches missed.">        if (command != null) {</span>
<span class="fc" id="L59">            Command command1  = commandFactory.createCommand(&quot;registration&quot;);</span>

            try {
<span class="fc" id="L62">                String path = command1.execute(request,response,model);</span>
<span class="fc" id="L63">                return path;</span>
<span class="nc" id="L64">            } catch (Exception e) {</span>
<span class="nc" id="L65">                return &quot;registration&quot;;</span>
            }
        }

<span class="nc" id="L69">        return &quot;registration&quot;;</span>
    }


    @RequestMapping(path = &quot;/changelanguage&quot;)
    public String languageHandler(ModelMap model,HttpServletRequest request,  HttpServletResponse response) {

<span class="fc" id="L76">        model.addAttribute(&quot;loginmessage&quot;,&quot;&quot;);</span>

       // Command command1  = commandFactory.createCommand(&quot;changelanguage&quot;);
        try {
<span class="fc" id="L80">            commandFactory.createCommand(&quot;changelanguage&quot;).execute(request,response,model);</span>
<span class="nc" id="L81">        } catch (Exception e) {</span>
<span class="nc" id="L82">            LOGGER.info(&quot;failed to switch language&quot;);</span>
<span class="fc" id="L83">        }</span>


<span class="fc" id="L86">        return &quot;redirect:/&quot;;</span>
    }





    @RequestMapping(path = &quot;/login**&quot;)
    public String getLogin(@RequestParam(value = &quot;error&quot;, required = false)String error,
                           @RequestParam(value = &quot;logout&quot;, required = false)String logout,
                           @RequestParam(value = &quot;command&quot;, required = false)String command,
                           ModelMap model,HttpServletRequest request,  HttpServletResponse response) {


<span class="nc" id="L100">        String loginmessage = (String) request.getSession().getAttribute(&quot;loginmessage&quot;);</span>

<span class="nc bnc" id="L102" title="All 2 branches missed.">        if(&quot;successful&quot;.equals(loginmessage))</span>
<span class="nc" id="L103">             model.addAttribute(&quot;loginmessage&quot;,loginmessage);</span>
        else
<span class="nc" id="L105">             model.addAttribute(&quot;loginmessage&quot;,&quot;&quot;);</span>



<span class="nc bnc" id="L109" title="All 2 branches missed.">        if (error != null)</span>
<span class="nc" id="L110">            model.addAttribute(&quot;loginmessage&quot;,&quot;loginfailed&quot;);</span>

<span class="nc" id="L112">        return &quot;login&quot;;</span>
    }




    @RequestMapping(path = &quot;/&quot;)
    public String logining(ModelMap model,HttpServletRequest request,  HttpServletResponse response) {


<span class="nc" id="L122">        Command command  = commandFactory.createCommand(&quot;login&quot;);</span>
        String path;
        try {
<span class="nc" id="L125">            path = command.execute(request,response,model);</span>

<span class="nc" id="L127">        } catch (Exception e) {</span>
<span class="nc" id="L128">            path = &quot;error&quot;;</span>
<span class="nc" id="L129">        }</span>

<span class="nc" id="L131">        return path;</span>
    }




    @RequestMapping(path = &quot;/sec**&quot;)
    public String secHandler(ModelMap model,HttpServletRequest request,  HttpServletResponse response) {

<span class="nc" id="L140">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span>

<span class="nc" id="L142">        Command command  = commandFactory.createCommand(&quot;togglepair&quot;);</span>
        String path;
        try {

<span class="nc" id="L146">            path = command.execute(request,response,model);</span>

<span class="nc" id="L148">        } catch (Exception e) {</span>
<span class="nc" id="L149">                    path = &quot;error&quot;;</span>
<span class="nc" id="L150">        }</span>
<span class="nc" id="L151">        return path;</span>
    }

    @RequestMapping(path = &quot;/market&quot;)
    public String marketHandler( @RequestParam(value = &quot;command&quot;, required = false)String scommand,ModelMap model,HttpServletRequest request,  HttpServletResponse response) {
<span class="nc" id="L156">        Command command  = commandFactory.createCommand(scommand);</span>
        String path;
        try {
<span class="nc" id="L159">            path = command.execute(request,response,model);</span>
<span class="nc" id="L160">        } catch (Exception e) {</span>
<span class="nc" id="L161">            path = &quot;error&quot;;</span>
<span class="nc" id="L162">        }</span>
<span class="nc" id="L163">        return path;</span>
    }


    @RequestMapping(path = &quot;/order&quot;)
    public String orderHandler( @RequestParam(value = &quot;command&quot;, required = false)String scommand,ModelMap model,HttpServletRequest request,  HttpServletResponse response) {
<span class="nc" id="L169">        Command command  = commandFactory.createCommand(scommand);</span>
        String path;
        try {
<span class="nc" id="L172">            path = command.execute(request,response,model);</span>
<span class="nc" id="L173">        } catch (Exception e) {</span>
<span class="nc" id="L174">            path = &quot;error&quot;;</span>
<span class="nc" id="L175">        }</span>
<span class="nc" id="L176">        return path;</span>
    }



    @RequestMapping(path = &quot;/wallet**&quot;)
    public String walletHandler( @RequestParam(value = &quot;command&quot;, required = false)String scommand,ModelMap model,HttpServletRequest request,  HttpServletResponse response) {

<span class="fc" id="L184">        Command command  = commandFactory.createCommand(scommand);</span>
        String path;
        try {

<span class="fc" id="L188">               path = command.execute(request,response,model);</span>
<span class="nc" id="L189">        } catch (Exception e) {</span>
<span class="nc" id="L190">            path = &quot;error&quot;;</span>
<span class="fc" id="L191">        }</span>
<span class="fc" id="L192">        return path;</span>
    }


    @RequestMapping(path = &quot;/admin**&quot;)
    public String adminHandler( @RequestParam(value = &quot;command&quot;, required = false)String scommand,ModelMap model,HttpServletRequest request,  HttpServletResponse response) {
<span class="nc" id="L198">        Command command  = commandFactory.createCommand(scommand);</span>
        String path;
        try {
<span class="nc" id="L201">            path = command.execute(request,response,model);</span>
<span class="nc" id="L202">        } catch (Exception e) {</span>
<span class="nc" id="L203">            path = &quot;error&quot;;</span>
<span class="nc" id="L204">        }</span>
<span class="nc" id="L205">        return path;</span>
    }



@Autowired
    UserServiceInter userService;

@Autowired
UserDaoImpl userDao;



    @RequestMapping(path = &quot;/test&quot;)
    public String getTest(@RequestParam(value = &quot;command&quot;, required = false)String command,
                                  ModelMap model,HttpServletRequest request,  HttpServletResponse response) throws Exception {



    /*    if (true) {
            throw new Exception();
        }*/

<span class="nc" id="L228">        ArrayList&lt;Integer&gt; list = new ArrayList();</span>
      /*  list.add(12);
        list.add(143);
        list.add(12);
        list.add(14);*/

/*
      User user = userDao.read(11);

        userDao.delete(user);*/




<span class="nc bnc" id="L242" title="All 2 branches missed.">        for (User user1 : userDao.read()) {</span>
<span class="nc" id="L243">            System.out.println(user1.getUserName()+&quot; &quot;+ user1.getIdentity() +&quot; &quot;+user1.getSurname());</span>
<span class="nc" id="L244">        }</span>



<span class="nc" id="L248">        model.addAttribute(&quot;intlist&quot;,list);</span>
<span class="nc" id="L249">        model.addAttribute(&quot;testparam&quot;,&quot;teeset&quot;);</span>

<span class="nc" id="L251">      return &quot;test&quot;;</span>
        }






}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>